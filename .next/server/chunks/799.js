exports.id=799,exports.ids=[799],exports.modules={98680:(e,t,a)=>{"use strict";a.r(t),a.d(t,{"7f8891ab2f04546eb02c6f73886a45db75960b1649":()=>g});var r=a(21590);a(70376);var s=a(63954),n=a(71010),i=a(21476);let l={X:"X",O:"O"},o=e=>e.field.filter(e=>null!==e).length%2==0?l.X:l.O,d=(e,t)=>{let a=t.players.findIndex(t=>t.id===e.id);return({0:l.X,1:l.O})[a]},c=(e,t,a)=>{let r=o(e);if(r!==d(a,e))return(0,n.kb)("not-player-symbol");if(e.field[t])return(0,n.kb)("game-cell-allready-has-symbol");let s=e.field.map((e,a)=>a===t?r:e);return m(s)?(0,n.pG)({...e,field:s,winner:a,status:"gameOver"}):!function(e){return!m(e)&&e.every(e=>null!==e)}(s)?(0,n.pG)({...e,field:s,status:"inProgress"}):(0,n.pG)({...e,field:s,status:"gameOverDraw"})};function m(e){let t=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(let a=0;a<t.length;a++){let[r,s,n]=t[a];if(e[r]&&e[r]===e[s]&&e[r]===e[n])return e[r]}return null}var u=a(75721);async function f(e,t,a){let r=await u.N.getGame({id:e});if(!r)return(0,n.kb)("game-not-found");if("inProgress"!==r.status)return(0,n.kb)("game-is-not-in-progress");if(!r.players.some(e=>e.id===t.id))return(0,n.kb)("player-is-not-in-game");let s=c(r,a,t);return"left"===s.type?s:(0,n.pG)(await u.N.saveGame(s.value))}var x=a(99344);let g=async({index:e,gameId:t})=>{let a=await (0,s.HW)();if(!a)return(0,n.kb)("not-found");let r=await f(t,a,e);return"right"===r.type&&i.u.emit(r.value),r};(0,x.D)([g]),(0,r.A)(g,"7f8891ab2f04546eb02c6f73886a45db75960b1649",null)},73994:(e,t,a)=>{Promise.resolve().then(a.bind(a,65230))},37042:(e,t,a)=>{Promise.resolve().then(a.bind(a,96521))},96521:(e,t,a)=>{"use strict";a.d(t,{GameClient:()=>p});var r=a(45512),s=a(30681),n=a(96294);function i({status:e,field:t,actions:a,players:i}){return(0,r.jsx)(n.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5,ease:"easeOut"},className:"max-w-xl w-full mx-auto",children:(0,r.jsxs)(s.Zp,{className:"backdrop-blur-md border border-gray-800 shadow-md rounded-lg",children:[(0,r.jsxs)(s.Wu,{className:"flex flex-col gap-4",children:[i,e,(0,r.jsx)("div",{className:"flex items-center justify-center p-6",children:t})]}),(0,r.jsx)(s.wL,{className:"flex justify-center",children:a})]})})}function l({game:e}){if(!e)return(0,r.jsx)("div",{className:"text-gray-400 text-center text-lg",children:"Loading players..."});let t="idle"===e.status?e.creator:e.players[0],a="idle"===e.status?null:e.players[1];return(0,r.jsxs)(n.P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"},className:"flex flex-col items-center py-6 backdrop-blur-md border border-gray-800 shadow-md rounded-lg",children:[(0,r.jsxs)(n.P.div,{whileHover:{scale:1.05},transition:{duration:.3},className:"flex flex-col items-center mb-4 gap-1",children:[(0,r.jsxs)("p",{className:"text-2xl font-bold text-red-400",children:["❌ ",t.login]}),(0,r.jsxs)("span",{className:"text-sm text-gray-400",children:["Rating: ",t.rating]})]}),(0,r.jsx)("div",{className:"w-full border-t border-gray-600 mb-4"}),a?(0,r.jsxs)(n.P.div,{whileHover:{scale:1.05},transition:{duration:.3},className:"flex flex-col items-center",children:[(0,r.jsxs)("p",{className:"text-2xl font-bold text-blue-400",children:["⭕ ",a.login]}),(0,r.jsxs)("span",{className:"text-sm text-gray-400",children:["Rating: ",a.rating]})]}):(0,r.jsx)(n.P.div,{initial:{opacity:.5},animate:{opacity:1},transition:{duration:1,repeat:1/0,repeatType:"reverse"},className:"text-gray-400 text-lg",children:"⏳ Waiting for player..."})]})}let o={X:"X",O:"O"},d=e=>e.field.filter(e=>null!==e).length%2==0?o.X:o.O;function c({game:e}){let t=null;return e?(("inProgress"===e.status||"gameOver"===e.status)&&(t=d(e)),(0,r.jsxs)(n.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5,ease:"easeOut"},className:"flex flex-col items-center text-center text-xl font-semibold rounded-lg",children:["idle"===e.status&&(0,r.jsxs)(n.P.div,{initial:{opacity:.6},animate:{opacity:1},transition:{duration:1.2,repeat:1/0,repeatType:"reverse"},className:"flex flex-col items-center text-gray-300 text-lg font-medium",children:["Searching for an opponent...",(0,r.jsx)("br",{}),"Invite a friend or wait for a challenger!"]}),"inProgress"===e.status&&(0,r.jsxs)(n.P.span,{className:"text-3xl font-bold",animate:{textShadow:"0px 0px 10px rgba(255, 255, 255, 0.5)"},children:["Current Turn: ","X"===t?"❌":"⭕"]}),"gameOver"===e.status&&(0,r.jsxs)(n.P.span,{className:"text-3xl font-bold text-green-400",animate:{scale:[1,1.1,1]},transition:{duration:.8,repeat:1/0,repeatType:"reverse"},children:["\uD83C\uDF89 Winner: ","O"===t?"❌":"⭕"]}),"gameOverDraw"===e.status&&(0,r.jsx)(n.P.span,{className:"text-3xl font-bold text-yellow-400",animate:{scale:[1,1.05,1]},transition:{duration:.8,repeat:1/0,repeatType:"reverse"},children:"\uD83E\uDD1D Draw! No winner."})]},e.status)):(0,r.jsx)("div",{className:"text-gray-400 text-center text-lg",children:"Loading game..."})}function m({game:e,onCellClick:t}){return e?(0,r.jsx)(n.P.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5,ease:"easeOut"},className:"grid grid-cols-3 gap-1 backdrop-blur-md border border-gray-800 p-3 rounded-lg relative",children:e.field.map((e,a)=>(0,r.jsx)(n.P.button,{onClick:()=>t(a),whileTap:{scale:.9},className:"w-16 h-16 flex justify-center items-center border border-gray-600 bg-gray-900 text-2xl font-bold text-white transition-all duration-300 hover:bg-gray-700",children:"X"===e?(0,r.jsx)(n.P.span,{className:"text-red-400",animate:{scale:[1,1.2,1]},transition:{duration:.5},children:"❌"}):"O"===e?(0,r.jsx)(n.P.span,{className:"text-blue-400",animate:{scale:[1,1.2,1]},transition:{duration:.5},children:"⭕"}):""},a))}):(0,r.jsx)("div",{className:"text-gray-400 text-center text-lg",children:"Loading game..."})}var u=a(62726),f=a(58009),x=a(26248);let g=(0,x.createServerReference)("7f8891ab2f04546eb02c6f73886a45db75960b1649",x.callServer,void 0,x.findSourceMapURL,"gameStepAction");function p({defaultGame:e}){let{game:t=e,step:a}=function(e){let{isPending:t,dataStream:a}=function(e){let[t,a]=(0,f.useState)(!0),[r,s]=(0,f.useState)(),[n,i]=(0,f.useState)();return{dataStream:r,error:n,isPending:t}}(u.J.gameStream(e)),[r,s]=(0,f.useTransition)();return{game:a,step:t=>{s(async()=>{await g({gameId:e,index:t})})},isPending:t,isStepPending:r}}(e.id);return(0,r.jsx)(i,{players:(0,r.jsx)(l,{game:t}),status:(0,r.jsx)(c,{game:t}),field:(0,r.jsx)(m,{game:t,onCellClick:a})})}},62726:(e,t,a)=>{"use strict";a.d(t,{J:()=>r});let r={signIn:()=>"/sign-in",signUp:()=>"/sign-up",game:e=>`/game/${e}`,gameStream:e=>`/game/${e}/stream`,gamesStream:()=>"/games/stream"}},30681:(e,t,a)=>{"use strict";a.d(t,{Wu:()=>o,Zp:()=>i,aR:()=>l,wL:()=>d});var r=a(45512),s=a(58009),n=a(549);let i=s.forwardRef(({className:e,...t},a)=>(0,r.jsx)("div",{ref:a,className:(0,n.cn)("rounded-xl border bg-card text-card-foreground shadow",e),...t}));i.displayName="Card";let l=s.forwardRef(({className:e,...t},a)=>(0,r.jsx)("div",{ref:a,className:(0,n.cn)("flex flex-col space-y-1.5",e),...t}));l.displayName="CardHeader",s.forwardRef(({className:e,...t},a)=>(0,r.jsx)("div",{ref:a,className:(0,n.cn)("font-semibold leading-none tracking-tight",e),...t})).displayName="CardTitle",s.forwardRef(({className:e,...t},a)=>(0,r.jsx)("div",{ref:a,className:(0,n.cn)("text-sm text-muted-foreground",e),...t})).displayName="CardDescription";let o=s.forwardRef(({className:e,...t},a)=>(0,r.jsx)("div",{ref:a,className:(0,n.cn)("",e),...t}));o.displayName="CardContent";let d=s.forwardRef(({className:e,...t},a)=>(0,r.jsx)("div",{ref:a,className:(0,n.cn)("flex items-center",e),...t}));d.displayName="CardFooter"},65230:(e,t,a)=>{"use strict";a.d(t,{GameClient:()=>r});let r=(0,a(46760).registerClientReference)(function(){throw Error("Attempted to call GameClient() from the server but GameClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\mb200\\OneDrive\\Документы\\GitHub\\mini-game\\src\\features\\game\\containers\\game-client.tsx","GameClient")},30994:(e,t,a)=>{"use strict";a.d(t,{Z:()=>m,V:()=>f});var r=a(62740),s=a(65230),n=a(47085),i=a(33655),l=a(31831),o=a(37404),d=a(25688);let c=e=>d.N.getGame({id:e});async function m({gameId:e}){let t=await (0,i.HW)(),a=await c(e);if(a||(0,l.redirect)("/"),t){let r=await (0,n.zj)(e,t);"right"===r.type&&(a=r.value,o.u.emit(r.value))}return(0,r.jsx)(s.GameClient,{defaultGame:a})}let u=e=>{let t=new TransformStream,a=t.writable.getWriter(),r=new TextEncoder;return{response:new Response(t.readable,{headers:{"Content-Type":"text/event-stream",Connection:"keep-alive","Cache-Control":"no-cache, no-transform"}}),write:e=>a.write(r.encode(`data: ${JSON.stringify(e)}

`)),close:()=>{a.close()},addCloseListener:t=>void e.signal.addEventListener("abort",()=>{t()})}};async function f(e,{params:t}){let{id:a}=await t,r=await (0,i.HW)(),s=await c(a);if(!s||!r)return new Response("Game not found",{status:404});let{addCloseListener:l,response:d,write:m}=u(e);m(s);let f=await o.u.addListener(s.id,e=>{m(e.data)});return l(async()=>{let e=await (0,n.Bt)(a,r);"right"===e.type&&o.u.emit(e.value),f()}),d}}};